---
title: Http 权威指南 第七章 缓存 笔记
date: 2020-06-04 09:11:13
tags:
---
***关键词*** : Modem  缓存命中  新鲜度检测  文档命中率  字节命中率
Modem(调制解调器，猫)
缓存命中(cache hit/miss)
***新鲜度检测*** : 缓存通过特殊请求检测内容是否最新，称为 ***Http 再验证*** (revalidation)  
如果新鲜度检测发现对象已经被删除，则服务器返回404，缓存也会将对应副本删除
客户端判断响应是否来自缓存: 可以通过首部 Via、Date、Age

![](/images/处理一个新鲜的缓存命中.jpeg)

#### 缓存的拓扑结构
***私有缓存*** : 浏览器本地的缓存
本地缓存可能存在内存、本地磁盘、甚至附近的另一台计算机中
***共有缓存*** : 缓存代理服务器(caching proxy server)
***层次化(hierarchy)的代理缓存*** : 父缓存，会增加性能损耗
***网状缓存、内容路由以及对等缓存*** : 网状的代理缓存之间会以更加复杂的方式进行对话，做出动态的缓存通信决策

#### 保持副本的新鲜
- 两种机制
  1. 文档过期(document expiration)
  2. 服务器再验证(server revalidation)
首部 Cache-control、Expires

***用条件方法进行再验证*** :
- 对缓存再验证最有用的两个 Htttp 条件首部: 
  1. If-Modified-Since: Date 再验证
  2. If-None-Match: 实体标签再验证，实体标签(ETag)可能包含文档的序列号或者版本号

***控制缓存的能力*** :
- 服务器可以通过 HTTP 定义的几种方式来指定在文档过期之前可以将其缓存多长时间
按照优先级递减的顺序，服务器可以附加一个:
  1. Cache-control: no-store  禁止缓存
  2. Cache-control: no-cache  缓存可以存在本地缓存区中，并且提供缓存之前必须进行新鲜度验证
  3. Cache-control: must-revalidate  通过验证只提供新鲜的副本
  4. Cache-control: max-age  处于新鲜状态的秒数
  5. Expires: Date
  6. 不附加，让缓存确定自己的过期日期

***缓存和公告*** :
缓存有好几种方式可以告诉源服务器它们拦截了多少次命中，比如:
1. 每次访问都进行验证
2. 日志迁移
3. 命中技术和使用限制: 命中次数首部 Meter

