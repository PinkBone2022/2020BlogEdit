---
title: Http 权威指南 第十四章 安全HTTP 笔记
date: 2020-06-12 14:32:10
tags:
---

***关键词*** : 密码学   对称加密   非对称加密   RSA算法   数字密码   CA   OpenSSL
#### 数字加密入门内容
* 密码: 对文本进行编码，使偷窥者无法识别的算法
* 秘钥: 改变密码行为的数字化参数
* 对称秘钥加密系统: 编/解码使用相同秘钥的算法
* 非对称秘钥加密系统: 编/解码使用不同秘钥的算法
* 公开秘钥加密系统: 
* 数字签名: 用来验证报文未被伪造或篡改的校验和
* 数字证书: 由一个可信的组织验证和签发的识别信息 

#### HTTPS
+ 位于安全层只上的 HTTP，这个安全层位于 TCP 之上
![](/images/HTTPS安全层.jpeg)
+ ***安全套接层协议***（Secure Sockets Layer  SSL），后继者 ***传输层安全性协议***（Transport Layer Security  TLS）
+ 网景(NetScape)公司首创


##### 两种登录方式
***密码口令登录*** :
- 通过密码进行登录，主要流程为:
  1. 客户端连接上服务器之后，服务器把自己的公钥传给客户端
  2. 客户端输入服务器密码通过公钥加密之后传给服务器
  3. 服务器根据自己的私钥解密登录密码，如果正确那么就让客户端登录
  
***公钥登录*** :
- 公钥登录是为了解决每次登录服务器都要输入密码的问题，流行使用RSA加密方案，主要流程包含：
  1. 客户端生成RSA公钥和私钥
  2. 客户端将自己的公钥存放到服务器
  3. 客户端请求连接服务器，服务器将一个随机字符串发送给客户端
  4. 客户端根据自己的私钥加密这个随机字符串之后再发送给服务器
  5. 服务器接受到加密后的字符串之后用公钥解密，如果正确就让客户端登录，否则拒绝。这样就不用使用密码了


##### 公私钥密码对
***公钥*** : 发布公钥
***私钥*** : 私有保密
RSA算法的作用:
***加密*** : 公钥加密私钥解密
***认证*** : 私钥加密公钥解密(签名)
公钥与私钥使用场景:　
(1)私钥用来进行解密和签名，是给自己用的
(2)公钥由本人公开，用于加密和验证签名，是给别人用的
(3)当该用户发送文件时，用私钥签名，别人用他给的公钥验证签名，可以保证该信息是由他发送的。当该用户接受文件时，别人用他的公钥加密，他用私钥解密，可以保证该信息只能由他接收到

##### 对称加密和非对称加密
***对称密钥加密技术*** : 编码时使用的密钥值和解码时一样
***非对称秘钥加密*** : ***公开秘钥加密技术*** 是非对称的，为编码和解码使用了不同的秘钥
***混合加密系统和会话密钥*** : 
1. 通常的做法是将对称加密的密钥进行非对称加密，然后传送给需要它的人
2. 非对称加密很安全，但是和对称加密比起来，它非常的慢
  混合使用对称和非对称策略:
  在两节点间通过便捷的公开秘钥加密技术建立起安全通信，然后用那条安全的通道产生并发送临时的随机对称秘钥(Session key 一次性会话密钥)，通过更快的对称加密技术对其余的数据进行加密
  (https 连接只在建立连接时，使用服务器的公钥加密，这个阶段是为了交换一个共享密钥。接下来的过程使用的是对称算法)


##### 数字签名
用私钥对报文摘要进行签名，这种方式可以验证身份以及保证报文的完整性

##### 签名算法特性
1. 确认消息的 ***完整性*** : 对比摘要是否相等
2. 确认消息的发布者 ***不可否认性*** : 用私钥签名过的摘要，只能用同对的公钥解码
3. 确认公钥的发布者 ***认证*** :
***RSA算法*** :

##### 数字证书
证书的本质就是对公钥施加数字签名
***站点证书的有效性*** :
+ 验证证书有效期(起止时间)
+ 验证证书域名(与浏览器地址栏中域名是否匹配)
+ 验证证书吊销状态(CRL+OCSP)
+ 验证证书颁发机构, 如果颁发机构是中间证书, 在验证中间证书的有效期/颁发机构/吊销状态. 一直验证到最后一层证书, 如果最后一层证书是在操作系统或浏览器内置, 那么就是可信的, 否则就是自签名

#### SSL 握手
+ SSL 是一个二进制协议，流量端口是 443
+ 如果 SSL 流量和 HTTP 流量都从端口 80 到达，大部分 Web服务器 会将二进制 SSL 流量理解为错误的 HTTP 并关闭连接
+ 将安全服务进一步整合到 HTTP 层中去就无需使用多个目的端口了
![](/images/SSL握手过程.jpg)
![](/images/ssl-handshake-rsa.png)

##### SSL 握手优化
+ session id 复用
+ 同步的吊销检查可能耗时

