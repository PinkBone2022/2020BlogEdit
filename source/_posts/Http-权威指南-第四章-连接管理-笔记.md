---
title: Http 权威指南 第四章 连接管理 笔记
date: 2020-06-02 17:33:08
tags:
---
``` bash
HTTP over TCP over IP (HTTPS -> TLS/SSL -> TCP -> IP)
```
报文分成数据块流动，每经过一层加相应的首部和一些控制及检测标记
#### 建立TCP连接 -- 握手
TCP 连接握手: 客户端发送一个小的TCP分组(设置了特殊的 SYN 标记)，服务器回送一个TCP分组(置位 SYN、ACK 标记)，客户端向服务器端发送确认信息
#### 用 TCP 套接字编程
操作系统提供了一些操作其 TCP 连接的工具(API 接口)
![](/images/客户端服务器通过tcp套接字通信.jpeg)
#### 提高 HTTP 连接性能
- 方法:
  1. 并行连接: 通过多条 TCP 连接发起并发的 HTTP 请求
    弊端: 带宽限制(多个连接按比例分配)，客户端内存消耗，服务器端需要处理更多并发请求
  2. 持久连接: 重用 TCP 连接，以消除连接和关闭时延
    Connectino: keep-alive
    Keep-Alive: max=5, timeout=120 (非承诺值)
  3. 管道化连接: 通过共享的 TCP 连接发起并发的 HTTP 请求
    在同一条 TCP连接 中多条请求报文放到队列中发送
    幂等的事务: 如果一个事务不管执行一次还是多次，得到的结果都相同（比如 GET\PUT\DELETE\HEAD\TRACE\OPTIONS）
    非幂等事务: POST，不应该以管道化方式传送非幂等请求
  4. 复用的连接: 交替传送请求和响应报文(试验阶段)  

***逐跳首部*** 只与一条特定连接有关，不能被转发
***哑代理*** 不认识 Connection 首部却向下游转发了这个首部，此后等待上游关闭连接，不在处理此条连接上的请求